<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MeTeoR</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/demo.css" />
    <!--必要样式-->
    <link rel="stylesheet" type="text/css" href="css/component.css" />
    <!--[if IE]>
  		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    <style>
        table,
        th,
        td {
            /* border: 1px solid black; */
            width: 60%;
            align: left;
        }

        #desc,
        #observe {
            width: 57%;
            font-size: 14px;
            align: left;
            margin-left: auto;
            margin-right: auto;
        }

        #result {
            width: 56%;
            font-size: 14px;
            align: left;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10px;
            margin-top: -20px;

        }

        header {
            font-size: 16px;
            margin-bottom: -100px;
            margin-top: -40px;
        }

        section {
            margin-bottom: -30px;
            margin-top: -50px;
        }

        .content {
            font-size: 17px;
        }

        .divcontainer {
            display: flex;
            justify-content: center;
        }

        .dataset {
            font-size: 12px;
            color: black;
            align: left;

        }

        .program {
            font-size: 12px;
            color: black;
            align: left;

        }

        .fact {
            font-size: 12px;
            color: black;
            align: left;
        }
    </style>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-env>
        - 'littleutils-0.2.2-py3-none-any.whl'
        - 'meteor_reasoner-1.0.3-py3-none-any.whl'
    </py-env>
</head>

<body>

    <div class="container">
        <header class="codrops-header">
            <h2>MeTeoR: metric temporal reasoner</h2>
        </header>

        <section class="content">
            <label for="cars"><b>Examples:</b></label>

            <select name="examples" id="examples">
                <option value="fd">Fraud Detection</option>
                <option value="sr">Sensor Readings</option>
                <option value="vi">Vaccination and Immunisation</option>
                <option value="bd">Backup Devices</option>
                <option value="im">Immortality</option>
            </select>
            <br /><br />
            <div id="desc" align="left"></div>
            <br /><br />
            <div id="observe" align="left"></div>
        </section>

        <section class="content">
            <div class="divcontainer">
                <div class="dataset">
                    <h3>Dataset:</h3>
                    <textarea id="dataset" minlength="10" maxlength="1500" rows="8" cols="40"></textarea>

                </div>
                <div class="program">
                    <h3>Program:</h3>
                    <textarea id="program" minlength="10" maxlength="1500" rows="8" cols="80"></textarea>
                </div>
                <div class="fact">
                    <h3>Fact:</h3>
                    <textarea id="fact" minlength="10" maxlength="1500" rows="8" cols="30"></textarea>
                </div>
            </div>
        </section>


        <hr/>
          <div> &nbsp; <button id="submit-button" type="submit" pys-onClick="my_function">Run</button> to check if the fact is entailed by the dataset
           and the program</div>
		<hr/>
        <br /><br />
        <div id="result" align="left"></div>
        <hr />


    </div>
</body>

</html>
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/spin-2.3.2.js"></script>
<script src="js/classie.js"></script>
<script type="text/javascript" src="js/classie.js') }}"></script>
<script type="text/javascript">
    (function () {
        // trim polyfill : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim
        if (!String.prototype.trim) {
            (function () {
                // Make sure we trim BOM and NBSP
                var rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
                String.prototype.trim = function () {
                    return this.replace(rtrim, '');
                };
            })();
        }

        [].slice.call(document.querySelectorAll('input.input__field')).forEach(function (inputEl) {
            // in case the input is already filled..
            if (inputEl.value.trim() !== '') {
                classie.add(inputEl.parentNode, 'input--filled');
            }

            // events:
            inputEl.addEventListener('focus', onInputFocus);
            inputEl.addEventListener('blur', onInputBlur);
        });

        function onInputFocus(ev) {
            classie.add(ev.target.parentNode, 'input--filled');
        }

        function onInputBlur(ev) {
            if (ev.target.value.trim() === '') {
                classie.remove(ev.target.parentNode, 'input--filled');
            }
        }
    })();
</script>
<script type="text/javascript">
    $(function () {
        $("#btn_submit").click(function () {
            var dataset = $("#dataset").val();
            var program = $("#program").val();
            var fact = $("#fact").val();
            if (!dataset.trim()) {
                alert("The dataset is empty !");
            }
            else if (!program.trim()) {
                alert("The program is empty !");
            }
            else if (!fact.trim()) {
                alert("The fact is empty !");
            }
            else {
                $("#result").html("Solving...");
                setTimeout(function () {
                    $.ajax(
                        {

                            type: "POST",
                            dataType: "json",
                            contentType: "application/json; charset=UTF-8",
                            data: JSON.stringify(
                                {
                                    "dataset": $("#dataset").val(),
                                    "program": $("#program").val(),
                                    "fact": $("#fact").val()
                                }),

                            url: "https://meteor.cs.ox.ac.uk/query",
                            success: function (data) {
                                var result = data.result;
                                $("#result").html(result);
                            },

                            error: function (data) {
                                //var result = data.result;
                                $("#one11").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Whoops, something wrong with the engine!!!");
                            }
                        });

                }, 10);

            }

        })
    })

</script>

<script type="text/javascript">
    function set_content(example) {
        $.ajax(
            {
                type: "POST",
                dataType: "json",
                contentType: "application/json; charset=UTF-8",
                data: JSON.stringify(
                    {
                        "dataset": example
                    }),

                url: "https://meteor.cs.ox.ac.uk/get_content",
                success: function (data) {
                    var dataset = data.dataset;
                    var program = data.program;
                    var fact = data.fact;
                    var desc = data.desc;
                    var observe = data.observe;
                    $("#dataset").val(dataset);
                    $("#program").val(program);
                    $("#fact").val(fact);
                    $("#desc").html(desc);
                    $("#observe").html(observe);
                },

                error: function () {

                }
            });
    }

</script>


<script type="text/javascript">
	$("#examples").change(function() {
		// jQuery
		var selectedVal = $(this).find(':selected').val();
		// var selectedText = $(this).find(':selected').text();
    if (selectedVal == "sr"){
          var dataset = "HighTemperature(sensor1)@[0,27.5]\nHighTemperature(sensor2)@3.5\nHighTemperature(sensor2)@5.1\nHighTemperature(sensor2)@10\nHighTemperature(sensor2)@14.7\nHighTemperature(sensor2)@20\nSameLocation(sensor1,sensor2)@(-inf,+inf)";
          var program = "Overheat(X) :- ALWAYS[-10,0] HighTemperature(X)\nOverheat(X) :- ALWAYS[-20,0] SOMETIME[-5.5,0] HighTemperature(X)\nAlert :- Overheat(X), Overheat(Y), SameLocation(X,Y)";
          var fact = "Alert@25"
          var desc = "<b>Description</b>:Consider a dataset with high temperature indications provided by sensors as well as with "
                "information about those sensors’ location. We can construct a program detecting overheated sensors, which "
                "are defined as sensors that continuously reported high temperature within the last 10 minutes, or reported high "
                "temperature in the last 20 minutes with high frequency (at least once per every 5.5 minutes). "
                "Then, an alert is triggered if two sensors in the same locations are overheated.";
          var observe = "<b>Observe</b>: We used a nesting of ALWAYS and SOMETIME operators to encoded events which happen frequently in a given period of time. Depending on the intervals used in these operators, we can control the period and the frequency of the events, respectively.";
          $("#dataset").val(dataset);
          $("#program").val(program);
          $("#fact").val(fact);
          $("#desc").html(desc);
          $("#observe").html(observe);
    }
   });
</script>
<script type="text/javascript">
		set_content("fd");
</script>
<py-script>
    from meteor_reasoner.entailment import entail
    def my_function(*args, **kwargs):
        dataset = Element('dataset').element.value
        dataset = dataset.split("\n")
        program = Element('program').element.value
        program = program.split("\n")
        fact = Element('fact').element.value
        fact = fact.strip()
        flag =  entail(dataset, program, fact)
        if flag:
            Element('result').element.innerText = "Entailed"
        else:
            Element('result').element.innerText = "Not Entailed"

</py-script>

